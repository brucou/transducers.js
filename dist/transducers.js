const symbolExists="undefined"!=typeof Symbol,protocols={iterator:symbolExists?Symbol.iterator:"@@iterator"};function throwProtocolError(t,r){throw new Error(`don't know how to ${t} collection: ${r}`)}function fulfillsProtocol(t,r){return"iterator"===r?t[protocols.iterator]||t.next:t[protocols[r]]}function getProtocolProperty(t,r){return t[protocols[r]]}function iterator(t){const r=getProtocolProperty(t,"iterator");return r?r.call(t):t.next?t:isArray(t)?new ArrayIterator(t):isObject(t)?new ObjectIterator(t):void 0}function ArrayIterator(t){this.arr=t,this.index=0}function ObjectIterator(t){this.obj=t,this.keys=Object.keys(t),this.index=0}ArrayIterator.prototype.next=function(){return this.index<this.arr.length?{value:this.arr[this.index++],done:!1}:{done:!0}},ObjectIterator.prototype.next=function(){if(this.index<this.keys.length){const t=this.keys[this.index++];return{value:[t,this.obj[t]],done:!1}}return{done:!0}};const toString=Object.prototype.toString,isArray="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"==toString.call(t)};function isFunction(t){return"function"==typeof t}function isObject(t){return t instanceof Object&&Object.getPrototypeOf(t)===Object.getPrototypeOf({})}function isNumber(t){return"number"==typeof t}function Reduced(t){this["@@transducer/reduced"]=!0,this["@@transducer/value"]=t}function isReduced(t){return t instanceof Reduced||t&&t["@@transducer/reduced"]}function deref(t){return t["@@transducer/value"]}function ensureReduced(t){return isReduced(t)?t:new Reduced(t)}function ensureUnreduced(t){return isReduced(t)?deref(t):t}function isIterable(t){return fulfillsProtocol(t,"iterator")||t.next||isObject(t)}function transformForObserver(t){return{"@@transducer/init":function(){return t},"@@transducer/step":function(t,r){return t.next(r),t},"@@transducer/result":function(t){t.complete()}}}function reduceLazyObservable(t,r,e,n){return new n(n=>{const i=r(e(n));return t.subscribe({next:t=>{try{i["@@transducer/step"](n,t)}catch(t){console.error("Error occurred in transducer/step!",t),n.error(t)}},error:t=>{console.error("Error occurred in observable passed to Rx transduce fn!",t),n.error(t)},complete:()=>{i["@@transducer/result"](n)}})})}function reduceIterable(t,r,e){if(isArray(t)){var n=e,i=-1;const u=t.length;for(;++i<u;)if(isReduced(n=r["@@transducer/step"](n,t[i]))){n=deref(n);break}return r["@@transducer/result"](n)}if(isObject(t)||fulfillsProtocol(t,"iterator")){n=e;for(var u=iterator(t),s=u.next();!s.done;){if(isReduced(n=r["@@transducer/step"](n,s.value))){n=deref(n);break}s=u.next()}return r["@@transducer/result"](n)}throwProtocolError("iterate",t)}function transduceLazyObservable(t,r,e){return reduceLazyObservable(t,r,transformForObserver,e)}function transduce(t,r,e,n){if(r=r(e),void 0===n&&(n=r["@@transducer/init"]()),isIterable(t))return reduceIterable(t,r,n)}function compose(){const t=Array.prototype.slice.call(arguments);return function(r){for(var e=r,n=t.length-1;n>=0;n--)e=t[n](e);return e}}function bound(t,r,e){if(!r)return t;switch(e=null!=e?e:1){case 1:return function(e){return t.call(r,e)};case 2:return function(e,n){return t.call(r,e,n)};default:return t.bind(r)}}function arrayMap(t,r,e){var n=-1;const i=t.length;var u=Array(i);for(r=bound(r,e,2);++n<i;)u[n]=r(t[n],n);return u}function arrayFilter(t,r,e){const n=t.length;var i=[];r=bound(r,e,2);for(var u=0;u<n;u++)r(t[u],u)&&i.push(t[u]);return i}function Map(t,r){this.xform=r,this.f=t}function Filter(t,r){this.xform=r,this.f=t}function Dedupe(t){this.xform=t,this.last=void 0}function TakeWhile(t,r){this.xform=r,this.f=t}function Take(t,r){this.n=t,this.i=0,this.xform=r}function Drop(t,r){this.n=t,this.i=0,this.xform=r}function DropWhile(t,r){this.xform=r,this.f=t,this.dropping=!0}function Partition(t,r){this.n=t,this.i=0,this.xform=r,this.part=new Array(t)}function PartitionBy(t,r){this.f=t,this.xform=r,this.part=[],this.last=NOTHING}function Interpose(t,r){this.sep=t,this.xform=r,this.started=!1}function Repeat(t,r){this.xform=r,this.n=t}function TakeNth(t,r){this.xform=r,this.n=t,this.i=-1}function Cat(t){this.xform=t}function push(t,r){return t.push(r),t}function merge(t,r){if(isArray(r)&&2===r.length)t[r[0]]=r[1];else for(var e=Object.keys(r),n=e.length,i=0;i<n;i++)t[e[i]]=r[e[i]];return t}Map.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},Map.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},Map.prototype["@@transducer/step"]=function(t,r){return this.xform["@@transducer/step"](t,this.f(r))},Filter.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},Filter.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},Filter.prototype["@@transducer/step"]=function(t,r){return this.f(r)?this.xform["@@transducer/step"](t,r):t},Dedupe.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},Dedupe.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},Dedupe.prototype["@@transducer/step"]=function(t,r){return r!==this.last?(this.last=r,this.xform["@@transducer/step"](t,r)):t},TakeWhile.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},TakeWhile.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},TakeWhile.prototype["@@transducer/step"]=function(t,r){return this.f(r)?this.xform["@@transducer/step"](t,r):new Reduced(t)},Take.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},Take.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},Take.prototype["@@transducer/step"]=function(t,r){return this.i<this.n&&(t=this.xform["@@transducer/step"](t,r),this.i+1>=this.n&&(t=ensureReduced(t))),this.i++,t},Drop.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},Drop.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},Drop.prototype["@@transducer/step"]=function(t,r){return this.i++<this.n?t:this.xform["@@transducer/step"](t,r)},DropWhile.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},DropWhile.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},DropWhile.prototype["@@transducer/step"]=function(t,r){if(this.dropping){if(this.f(r))return t;this.dropping=!1}return this.xform["@@transducer/step"](t,r)},Partition.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},Partition.prototype["@@transducer/result"]=function(t){return this.i>0?ensureUnreduced(this.xform["@@transducer/step"](t,this.part.slice(0,this.i))):this.xform["@@transducer/result"](t)},Partition.prototype["@@transducer/step"]=function(t,r){if(this.part[this.i]=r,this.i+=1,this.i===this.n){var e=this.part.slice(0,this.n);return this.part=new Array(this.n),this.i=0,this.xform["@@transducer/step"](t,e)}return t},PartitionBy.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},PartitionBy.prototype["@@transducer/result"]=function(t){var r=this.part.length;return r>0?ensureUnreduced(this.xform["@@transducer/step"](t,this.part.slice(0,r))):this.xform["@@transducer/result"](t)},PartitionBy.prototype["@@transducer/step"]=function(t,r){var e=this.f(r);return e===this.last||this.last===NOTHING?this.part.push(r):(t=this.xform["@@transducer/step"](t,this.part),this.part=[r]),this.last=e,t},Interpose.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},Interpose.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},Interpose.prototype["@@transducer/step"]=function(t,r){if(this.started){var e=this.xform["@@transducer/step"](t,this.sep);return isReduced(e)?e:this.xform["@@transducer/step"](e,r)}return this.started=!0,this.xform["@@transducer/step"](t,r)},Repeat.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},Repeat.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},Repeat.prototype["@@transducer/step"]=function(t,r){for(var e=this.n,n=t,i=0;i<e&&!isReduced(n=this.xform["@@transducer/step"](n,r));i++);return n},TakeNth.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},TakeNth.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},TakeNth.prototype["@@transducer/step"]=function(t,r){return this.i+=1,this.i%this.n==0?this.xform["@@transducer/step"](t,r):t},Cat.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},Cat.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},Cat.prototype["@@transducer/step"]=function(t,r){var e=this.xform,n={"@@transducer/init":function(){return e["@@transducer/init"]()},"@@transducer/result":function(t){return t},"@@transducer/step":function(t,r){var n=e["@@transducer/step"](t,r);return isReduced(n)?deref(n):n}};return reduceIterable(r,n,t)};var arrayReducer={"@@transducer/init":function(){return[]},"@@transducer/result":function(t){return t}};arrayReducer["@@transducer/step"]=push;var objReducer={};function toArray(t,r){return r?transduce(t,r,arrayReducer,[]):reduceIterable(t,arrayReducer,[])}function toObj(t,r){return r?transduce(t,r,objReducer,{}):reduceIterable(t,objReducer,{})}function toIter(t,r){return r?new LazyTransformer(r,t):iterator(t)}function seq(t,r){return isArray(t)?transduce(t,r,arrayReducer,[]):isObject(t)?transduce(t,r,objReducer,{}):t["@@transducer/step"]?(e=t["@@transducer/init"]?t["@@transducer/init"]():new t.constructor,transduce(t,r,t,e)):fulfillsProtocol(t,"iterator")?new LazyTransformer(r,t):void throwProtocolError("sequence",t);var e}function into(t,r,e){return isArray(t)?transduce(e,r,arrayReducer,t):isObject(t)?transduce(e,r,objReducer,t):t["@@transducer/step"]?transduce(e,r,t,t):void throwProtocolError("into",t)}objReducer["@@transducer/init"]=function(){return{}},objReducer["@@transducer/result"]=function(t){return t},objReducer["@@transducer/step"]=merge;var stepper={};function Stepper(t,r){this.xform=t(stepper),this.iter=r}function LazyTransformer(t,r){this.iter=iterator(r),this.items=[],this.stepper=new Stepper(t,iterator(r))}function transformer(t){var r={"@@transducer/init":function(){throw new Error("init value unavailable")},"@@transducer/result":function(t){return t}};return r["@@transducer/step"]=t,r}function map(t,r,e){return isFunction(t)&&(e=r,r=t,t=null),r=bound(r,e),t?isArray(t)?arrayMap(t,r,e):seq(t,map(r)):function(t){return new Map(r,t)}}function filter(t,r,e){return isFunction(t)&&(e=r,r=t,t=null),r=bound(r,e),t?isArray(t)?arrayFilter(t,r,e):seq(t,filter(r)):function(t){return new Filter(r,t)}}function remove(t,r,e){return isFunction(t)&&(e=r,r=t,t=null),r=bound(r,e),filter(t,function(t){return!r(t)})}function keep(t){return filter(t,function(t){return null!=t})}function dedupe(t){return t?seq(t,dedupe()):function(t){return new Dedupe(t)}}function takeWhile(t,r,e){return isFunction(t)&&(e=r,r=t,t=null),r=bound(r,e),t?seq(t,takeWhile(r)):function(t){return new TakeWhile(r,t)}}function take(t,r){return isNumber(t)&&(r=t,t=null),t?seq(t,take(r)):function(t){return new Take(r,t)}}function drop(t,r){return isNumber(t)&&(r=t,t=null),t?seq(t,drop(r)):function(t){return new Drop(r,t)}}function dropWhile(t,r,e){return isFunction(t)&&(e=r,r=t,t=null),r=bound(r,e),t?seq(t,dropWhile(r)):function(t){return new DropWhile(r,t)}}function partition(t,r){return isNumber(t)&&(r=t,t=null),t?seq(t,partition(r)):function(t){return new Partition(r,t)}}stepper["@@transducer/result"]=function(t){return isReduced(t)?deref(t):t},stepper["@@transducer/step"]=function(t,r){return t.items.push(r),t.rest},Stepper.prototype["@@transducer/step"]=function(t){for(var r=t.items.length;t.items.length===r;){var e=this.iter.next();if(e.done||isReduced(e.value)){this.xform["@@transducer/result"](this);break}this.xform["@@transducer/step"](t,e.value)}},LazyTransformer.prototype[protocols.iterator]=function(){return this},LazyTransformer.prototype.next=function(){return this["@@transducer/step"](),this.items.length?{value:this.items.pop(),done:!1}:{done:!0}},LazyTransformer.prototype["@@transducer/step"]=function(){this.items.length||this.stepper["@@transducer/step"](this)};const NOTHING={};function partitionBy(t,r,e){return isFunction(t)&&(e=r,r=t,t=null),r=bound(r,e),t?seq(t,partitionBy(r)):function(t){return new PartitionBy(r,t)}}function interpose(t,r){return 1===arguments.length?(r=t,function(t){return new Interpose(r,t)}):seq(t,interpose(r))}function repeat(t,r){return 1===arguments.length?(r=t,function(t){return new Repeat(r,t)}):seq(t,repeat(r))}function takeNth(t,r){return 1===arguments.length?(r=t,function(t){return new TakeNth(r,t)}):seq(t,takeNth(r))}function cat(t){return new Cat(t)}function mapcat(t,r){return compose(map(t=bound(t,r)),cat)}function StartWith(t,r){this.xform=r,this.initValue=t,this.hasSentInitialValue=!1}function startWith(t){return function(r){return new StartWith(t,r)}}StartWith.prototype["@@transducer/init"]=function(){return this.xform["@@transducer/init"]()},StartWith.prototype["@@transducer/result"]=function(t){return this.xform["@@transducer/result"](t)},StartWith.prototype["@@transducer/step"]=function(t,r){return this.hasSentInitialValue?this.xform["@@transducer/step"](t,r):(this.hasSentInitialValue=!0,this.xform["@@transducer/step"](this.xform["@@transducer/step"](t,this.initValue),r))};export{iterator,Reduced,isReduced,reduceLazyObservable,reduceIterable,transduceLazyObservable,transduce,compose,push,merge,toArray,toObj,toIter,seq,into,LazyTransformer,transformer,map,filter,remove,keep,dedupe,takeWhile,take,drop,dropWhile,partition,partitionBy,interpose,repeat,takeNth,cat,mapcat,startWith};
